<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bot Trading Multi-Crypto Pro - Telegram Chat</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        body {
            background: linear-gradient(to bottom right, #0f172a, #581c87, #0f172a);
            min-height: 100vh;
        }
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .pulse {
            animation: pulse 2s ease-in-out infinite;
        }
        .telegram-gradient {
            background: linear-gradient(135deg, #0088cc, #00bcd4);
        }
    </style>
</head>
<body class="text-white p-4 md:p-6">
    <div class="max-w-7xl mx-auto">
        <!-- Header avec boutons de chat -->
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-8">
            <div>
                <h1 class="text-3xl md:text-4xl font-bold bg-gradient-to-r from-yellow-400 to-orange-500 bg-clip-text text-transparent">
                    Bot Trading Multi-Crypto Pro
                </h1>
                <p class="text-gray-400 mt-2">Trading r√©el BSC ‚Ä¢ Prix temps r√©el ‚Ä¢ Chat Telegram Live</p>
            </div>
            
            <div class="flex gap-3 flex-wrap">
                <!-- Bouton Telegram Channel -->
                <button onclick="openTelegramChannel()" class="flex items-center gap-2 px-4 py-3 telegram-gradient hover:opacity-90 rounded-lg font-semibold transition-all shadow-lg">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.894 8.221l-1.97 9.28c-.145.658-.537.818-1.084.508l-3-2.21-1.446 1.394c-.14.18-.357.295-.6.295-.002 0-.003 0-.005 0l.213-3.054 5.56-5.022c.24-.213-.054-.334-.373-.121l-6.869 4.326-2.96-.924c-.64-.203-.658-.64.135-.954l11.566-4.458c.538-.196 1.006.128.832.941z"/>
                    </svg>
                    <span>Canal Telegram</span>
                    <span class="bg-red-500 text-white text-xs px-2 py-0.5 rounded-full pulse">LIVE</span>
                </button>
                
                <!-- Bouton Telegram Bot -->
                <button onclick="openTelegramBot()" class="flex items-center gap-2 px-4 py-3 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 rounded-lg font-semibold transition-all">
                    <span>ü§ñ</span>
                    <span>Bot Telegram</span>
                </button>
                
                <!-- Bouton Chat Int√©gr√© -->
                <button onclick="openIntegratedChat()" class="flex items-center gap-2 px-4 py-3 bg-gradient-to-r from-green-500 to-teal-600 hover:from-green-600 hover:to-teal-700 rounded-lg font-semibold transition-all">
                    <span>üí¨</span>
                    <span>Chat Live</span>
                    <span id="unreadBadge" class="hidden bg-red-500 text-white text-xs px-2 py-0.5 rounded-full">0</span>
                </button>
                
                <button onclick="openDCASwap()" class="flex items-center gap-2 px-4 py-3 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 rounded-lg font-semibold transition-all">
                    <span>üîÑ</span>
                    DCA/Swap
                    <span>‚Üó</span>
                </button>
                
                <button onclick="connectWallet()" id="connectBtn" class="flex items-center gap-2 px-6 py-3 rounded-lg font-semibold transition-all bg-gradient-to-r from-yellow-400 to-orange-500 hover:from-yellow-500 hover:to-orange-600">
                    <span>üëõ</span>
                    <span id="walletText">Connecter MetaMask</span>
                </button>
            </div>
        </div>

        <!-- Banni√®re Telegram Info -->
        <div class="bg-gradient-to-r from-blue-500/20 to-purple-500/20 border-2 border-blue-500 rounded-xl p-6 mb-6">
            <div class="flex items-start gap-4">
                <div class="text-4xl">üì±</div>
                <div class="flex-1">
                    <h3 class="text-xl font-bold mb-2 flex items-center gap-2">
                        Rejoignez notre communaut√© Telegram !
                    </h3>
                    <p class="text-gray-300 mb-4">
                        üéØ Signaux de trading en temps r√©el<br>
                        üìä Analyses techniques quotidiennes<br>
                        üí° Conseils et strat√©gies de la communaut√©<br>
                        ü§ñ Commandes bot automatiques<br>
                        üë• <span id="telegramMembersCount" class="text-green-400 font-bold">1,234</span> membres actifs
                    </p>
                    <div class="flex gap-3">
                        <button onclick="openTelegramChannel()" class="px-6 py-2 telegram-gradient hover:opacity-90 rounded-lg font-semibold transition-all">
                            Rejoindre le Canal
                        </button>
                        <button onclick="openTelegramBot()" class="px-6 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg font-semibold transition-all">
                            D√©marrer le Bot
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Rest of your existing sections... -->
        <div id="subscriptionSection" class="bg-gradient-to-r from-purple-500/20 to-pink-500/20 border-2 border-purple-500 rounded-xl p-6 mb-6 hidden">
            <!-- Existing subscription content -->
        </div>

        <div id="cryptoSelector" class="bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-6 mb-6 hidden">
            <!-- Existing crypto selector content -->
        </div>

        <!-- Main Trading Interface -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Trading Section (left) -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Your existing trading interface -->
            </div>

            <!-- Sidebar with Telegram Chat Widget (right) -->
            <div class="space-y-6">
                <!-- Telegram Chat Widget -->
                <div class="bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-6">
                    <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
                        <svg class="w-6 h-6 text-blue-400" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.894 8.221l-1.97 9.28c-.145.658-.537.818-1.084.508l-3-2.21-1.446 1.394c-.14.18-.357.295-.6.295-.002 0-.003 0-.005 0l.213-3.054 5.56-5.022c.24-.213-.054-.334-.373-.121l-6.869 4.326-2.96-.924c-.64-.203-.658-.64.135-.954l11.566-4.458c.538-.196 1.006.128.832.941z"/>
                        </svg>
                        Telegram Live
                    </h2>
                    
                    <div class="space-y-3">
                        <div class="bg-gradient-to-r from-blue-500/20 to-blue-600/20 border border-blue-500/50 rounded-lg p-4">
                            <p class="text-sm text-blue-200 mb-2">
                                <span class="text-green-400">‚óè</span> <span id="telegramOnline">847</span> en ligne
                            </p>
                            <p class="text-xs text-gray-400">
                                Derniers signaux et discussions de la communaut√©
                            </p>
                        </div>

                        <!-- Telegram Messages Preview -->
                        <div id="telegramPreview" class="space-y-2 max-h-60 overflow-y-auto">
                            <!-- Messages will be loaded here -->
                        </div>

                        <button onclick="openIntegratedChat()" class="w-full px-4 py-3 telegram-gradient hover:opacity-90 rounded-lg font-semibold transition-all flex items-center justify-center gap-2">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.894 8.221l-1.97 9.28c-.145.658-.537.818-1.084.508l-3-2.21-1.446 1.394c-.14.18-.357.295-.6.295-.002 0-.003 0-.005 0l.213-3.054 5.56-5.022c.24-.213-.054-.334-.373-.121l-6.869 4.326-2.96-.924c-.64-.203-.658-.64.135-.954l11.566-4.458c.538-.196 1.006.128.832.941z"/>
                            </svg>
                            Ouvrir le Chat Complet
                        </button>

                        <div class="flex gap-2">
                            <button onclick="openTelegramChannel()" class="flex-1 px-3 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-sm transition-all">
                                üì¢ Canal
                            </button>
                            <button onclick="openTelegramBot()" class="flex-1 px-3 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-sm transition-all">
                                ü§ñ Bot
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Settings Section -->
                <div class="bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-6">
                    <h2 class="text-2xl font-bold mb-4">Param√®tres</h2>
                    <!-- Your existing settings -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Chat Telegram Int√©gr√© -->
    <div id="telegramChatModal" class="hidden fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4" style="z-index: 9999;">
        <div class="bg-gradient-to-br from-slate-900 to-slate-800 rounded-2xl shadow-2xl w-full max-w-5xl h-[700px] flex flex-col border-2 border-blue-500/30">
            <!-- Header Chat -->
            <div class="telegram-gradient flex justify-between items-center p-6 rounded-t-2xl">
                <div class="flex items-center gap-4">
                    <svg class="w-10 h-10" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.894 8.221l-1.97 9.28c-.145.658-.537.818-1.084.508l-3-2.21-1.446 1.394c-.14.18-.357.295-.6.295-.002 0-.003 0-.005 0l.213-3.054 5.56-5.022c.24-.213-.054-.334-.373-.121l-6.869 4.326-2.96-.924c-.64-.203-.658-.64.135-.954l11.566-4.458c.538-.196 1.006.128.832.941z"/>
                    </svg>
                    <div>
                        <h2 class="text-2xl font-bold">
                            Chat Communautaire Telegram
                        </h2>
                        <p class="text-sm text-blue-100 mt-1">
                            <span class="text-green-300">‚óè</span> 
                            <span id="telegramOnlineCount">...</span> membres en ligne
                        </p>
                    </div>
                </div>
                <button onclick="closeIntegratedChat()" class="text-white hover:bg-white/20 transition-all text-2xl rounded-lg px-3 py-1">‚úï</button>
            </div>

            <!-- Tab Navigation -->
            <div class="flex border-b border-slate-700 bg-slate-900/50">
                <button onclick="switchTab('chat')" id="chatTab" class="flex-1 px-6 py-3 font-semibold transition-all border-b-2 border-blue-500 text-blue-400">
                    üí¨ Discussion G√©n√©rale
                </button>
                <button onclick="switchTab('signals')" id="signalsTab" class="flex-1 px-6 py-3 font-semibold transition-all border-b-2 border-transparent text-gray-400 hover:text-white">
                    üìä Signaux Trading
                </button>
                <button onclick="switchTab('bot')" id="botTab" class="flex-1 px-6 py-3 font-semibold transition-all border-b-2 border-transparent text-gray-400 hover:text-white">
                    ü§ñ Bot Commands
                </button>
            </div>

            <!-- Chat Content Area -->
            <div id="chatContent" class="flex-1 overflow-y-auto p-6 space-y-4 bg-slate-900/50">
                <!-- Messages will be loaded here -->
            </div>

            <!-- Bot Commands Quick Access -->
            <div id="quickCommands" class="p-4 border-t border-slate-700 bg-slate-900/80">
                <div class="flex gap-2 overflow-x-auto pb-2">
                    <button onclick="sendTelegramCommand('/start')" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm whitespace-nowrap transition-all">
                        /start - D√©marrer
                    </button>
                    <button onclick="sendTelegramCommand('/price BTC')" class="px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-sm whitespace-nowrap transition-all">
                        /price - Prix actuel
                    </button>
                    <button onclick="sendTelegramCommand('/signals')" class="px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-sm whitespace-nowrap transition-all">
                        /signals - Signaux
                    </button>
                    <button onclick="sendTelegramCommand('/stats')" class="px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-sm whitespace-nowrap transition-all">
                        /stats - Statistiques
                    </button>
                    <button onclick="sendTelegramCommand('/help')" class="px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-sm whitespace-nowrap transition-all">
                        /help - Aide
                    </button>
                </div>
            </div>

            <!-- Input Area -->
            <div class="p-4 border-t border-slate-700 bg-slate-900">
                <div class="flex gap-3">
                    <input 
                        type="text" 
                        id="telegramInput" 
                        placeholder="Tapez votre message ou /commande..."
                        class="flex-1 bg-slate-700/50 border border-slate-600 rounded-lg px-4 py-3 focus:outline-none focus:border-blue-400 text-white placeholder-gray-400"
                        onkeypress="if(event.key === 'Enter') sendTelegramMessage()"
                    >
                    <button onclick="sendTelegramMessage()" class="px-6 py-3 telegram-gradient hover:opacity-90 rounded-lg font-semibold transition-all">
                        Envoyer üì§
                    </button>
                </div>
                <p class="text-xs text-gray-500 mt-2 flex items-center gap-2">
                    üí° Partagez vos analyses et recevez des signaux en temps r√©el
                    <button onclick="showTelegramHelp()" class="text-blue-400 hover:underline">Voir les commandes</button>
                </p>
            </div>
        </div>
    </div>

    <!-- Modal Telegram Guide -->
    <div id="telegramGuideModal" class="hidden fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4" style="z-index: 10000;">
        <div class="bg-gradient-to-br from-slate-900 to-slate-800 rounded-2xl shadow-2xl w-full max-w-2xl border-2 border-blue-500/30">
            <div class="telegram-gradient p-6 rounded-t-2xl">
                <div class="flex justify-between items-center">
                    <h2 class="text-2xl font-bold">ü§ñ Guide Telegram Bot</h2>
                    <button onclick="closeTelegramGuide()" class="text-white hover:bg-white/20 rounded-lg px-3 py-1 text-2xl">‚úï</button>
                </div>
            </div>
            
            <div class="p-6 space-y-4 max-h-[500px] overflow-y-auto">
                <div class="bg-blue-500/20 border border-blue-500 rounded-lg p-4">
                    <h3 class="font-bold text-blue-300 mb-2">üì± Commandes Principales</h3>
                    <div class="space-y-2 text-sm">
                        <p><code class="bg-slate-700 px-2 py-1 rounded">/start</code> - D√©marrer le bot</p>
                        <p><code class="bg-slate-700 px-2 py-1 rounded">/price [CRYPTO]</code> - Prix actuel (ex: /price BTC)</p>
                        <p><code class="bg-slate-700 px-2 py-1 rounded">/signals</code> - Signaux de trading du jour</p>
                        <p><code class="bg-slate-700 px-2 py-1 rounded">/stats</code> - Vos statistiques de trading</p>
                        <p><code class="bg-slate-700 px-2 py-1 rounded">/subscribe</code> - Notifications automatiques</p>
                        <p><code class="bg-slate-700 px-2 py-1 rounded">/help</code> - Liste compl√®te des commandes</p>
                    </div>
                </div>

                <div class="bg-green-500/20 border border-green-500 rounded-lg p-4">
                    <h3 class="font-bold text-green-300 mb-2">üìä Commandes Trading</h3>
                    <div class="space-y-2 text-sm">
                        <p><code class="bg-slate-700 px-2 py-1 rounded">/buy [CRYPTO] [AMOUNT]</code> - Ordre d'achat</p>
                        <p><code class="bg-slate-700 px-2 py-1 rounded">/sell [CRYPTO] [AMOUNT]</code> - Ordre de vente</p>
                        <p><code class="bg-slate-700 px-2 py-1 rounded">/portfolio</code> - Voir votre portfolio</p>
                        <p><code class="bg-slate-700 px-2 py-1 rounded">/alert [CRYPTO] [PRICE]</code> - Alerte de prix</p>
                    </div>
                </div>

                <div class="bg-purple-500/20 border border-purple-500 rounded-lg p-4">
                    <h3 class="font-bold text-purple-300 mb-2">üéØ Fonctionnalit√©s Premium</h3>
                    <div class="space-y-2 text-sm">
                        <p>‚úÖ Signaux de trading en temps r√©el</p>
                        <p>‚úÖ Analyses techniques automatiques</p>
                        <p>‚úÖ Alertes personnalis√©es</p>
                        <p>‚úÖ Ex√©cution d'ordres depuis Telegram</p>
                        <p>‚úÖ Rapports quotidiens de performance</p>
                    </div>
                </div>
            </div>

            <div class="p-6 border-t border-slate-700">
                <button onclick="openTelegramBot()" class="w-full px-6 py-3 telegram-gradient hover:opacity-90 rounded-lg font-semibold transition-all">
                    Ouvrir le Bot Telegram
                </button>
            </div>
        </div>
    </div>

    <script>
        // Telegram Configuration
        const TELEGRAM_CONFIG = {
            channelUrl: 'https://t.me/crypto_trading_signals_pro', // Remplacez par votre canal
            botUrl: 'https://t.me/CryptoTradingProBot', // Remplacez par votre bot
            botToken: 'YOUR_BOT_TOKEN', // Pour l'API (optionnel)
            chatId: 'YOUR_CHAT_ID' // Pour l'API (optionnel)
        };

        // √âtat du chat
        let telegramState = {
            currentTab: 'chat',
            messages: [],
            signals: [],
            onlineUsers: 847,
            unreadCount: 0,
            username: '',
            isConnected: false
        };

        // Initialisation
        window.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ Bot Trading avec Telegram charg√©');
            initializeTelegram();
            startTelegramSimulation();
            updateTelegramStats();
        });

        // Fonctions Telegram
        function initializeTelegram() {
            // G√©n√©rer username
            if (!telegramState.username) {
                const adjectives = ['Alpha', 'Crypto', 'Diamond', 'Moon', 'Whale', 'Bull', 'Bear'];
                const nouns = ['Trader', 'Investor', 'King', 'Master', 'Hunter', 'Pro'];
                const adj = adjectives[Math.floor(Math.random() * adjectives.length)];
                const noun = nouns[Math.floor(Math.random() * nouns.length)];
                telegramState.username = `${adj}${noun}${Math.floor(Math.random() * 999)}`;
            }

            // Charger messages sauvegard√©s
            const saved = localStorage.getItem('telegramMessages');
            if (saved) {
                telegramState.messages = JSON.parse(saved);
            } else {
                loadDefaultTelegramMessages();
            }

            // Charger signaux
            loadTradingSignals();
            
            console.log('‚úÖ Telegram initialis√© - Username:', telegramState.username);
        }

        function loadDefaultTelegramMessages() {
            telegramState.messages = [
                {
                    username: 'Admin',
                    message: 'üëã Bienvenue sur le chat Telegram de la communaut√© Trading Pro !',
                    timestamp: Date.now() - 7200000,
                    type: 'system',
                    avatar: 'üë®‚Äçüíº'
                },
                {
                    username: 'CryptoKing',
                    message: 'BTC vient de casser les 95k ! üöÄ Signal haussier confirm√©',
                    timestamp: Date.now() - 3600000,
                    type: 'user',
                    avatar: 'üëë'
                },
                {
                    username: 'ETHTrader',
                    message: 'Mon bot a fait +3.2% sur ETH aujourd\'hui. RSI strategy fonctionne bien',
                    timestamp: Date.now() - 1800000,
                    type: 'user',
                    avatar: 'üíé'
                },
                {
                    username: 'TradingBot',
                    message: 'ü§ñ Signal: BTC RSI √† 68 - Possible correction √† venir',
                    timestamp: Date.now() - 900000,
                    type: 'bot',
                    avatar: 'ü§ñ'
                },
                {
                    username: 'BNBWhale',
                    message: 'Volume BNB en forte hausse. Qui trade sur PancakeSwap ?',
                    timestamp: Date.now() - 300000,
                    type: 'user',
                    avatar: 'üêã'
                }
            ];
        }

        function loadTradingSignals() {
            telegramState.signals = [
                {
                    crypto: 'BTC',
                    type: 'BUY',
                    price: 94850,
                    target: 97000,
                    stopLoss: 93500,
                    confidence: 85,
                    timestamp: Date.now() - 1800000
                },
                {
                    crypto: 'ETH',
                    type: 'SELL',
                    price: 3425,
                    target: 3300,
                    stopLoss: 3500,
                    confidence: 72,
                    timestamp: Date.now() - 3600000
                },
                {
                    crypto: 'BNB',
                    type: 'HOLD',
                    price: 652,
                    note: 'Attendre confirmation breakout 660',
                    confidence: 65,
                    timestamp: Date.now() - 5400000
                }
            ];
        }

        function openTelegramChannel() {
            window.open(TELEGRAM_CONFIG.channelUrl, '_blank');
            console.log('üì¢ Ouverture du canal Telegram');
        }

        function openTelegramBot() {
            window.open(TELEGRAM_CONFIG.botUrl, '_blank');
            console.log('ü§ñ Ouverture du bot Telegram');
        }

        function openIntegratedChat() {
            document.getElementById('telegramChatModal').classList.remove('hidden');
            telegramState.unreadCount = 0;
            updateUnreadBadge();
            switchTab('chat');
            console.log('üí¨ Chat int√©gr√© ouvert');
        }

        function closeIntegratedChat() {
            document.getElementById('telegramChatModal').classList.add('hidden');
        }

        function switchTab(tab) {
            telegramState.currentTab = tab;
            
            // Update tab buttons
            ['chat', 'signals', 'bot'].forEach(t => {
                const btn = document.getElementById(t + 'Tab');
                if (t === tab) {
                    btn.className = 'flex-1 px-6 py-3 font-semibold transition-all border-b-2 border-blue-500 text-blue-400';
                } else {
                    btn.className = 'flex-1 px-6 py-3 font-semibold transition-all border-b-2 border-transparent text-gray-400 hover:text-white';
                }
            });
            
            // Load content
            renderChatContent(tab);
        }

        function renderChatContent(tab) {
            const container = document.getElementById('chatContent');
            
            if (tab === 'chat') {
                renderChatMessages(container);
            } else if (tab === 'signals') {
                renderTradingSignals(container);
            } else if (tab === 'bot') {
                renderBotCommands(container);
            }
        }

        function renderChatMessages(container) {
            if (telegramState.messages.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-gray-400 py-8">
                        <p class="text-4xl mb-4">üí¨</p>
                        <p>Aucun message pour le moment</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = telegramState.messages.map(msg => {
                const time = new Date(msg.timestamp).toLocaleTimeString('fr-FR', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                
                const isOwn = msg.username === telegramState.username;
                const isBot = msg.type === 'bot';
                const isSystem = msg.type === 'system';
                
                if (isSystem) {
                    return `
                        <div class="flex justify-center my-4">
                            <div class="bg-blue-500/20 border border-blue-500/50 rounded-lg px-4 py-2 text-sm text-blue-300">
                                ${escapeHtml(msg.message)}
                            </div>
                        </div>
                    `;
                }
                
                return `
                    <div class="flex ${isOwn ? 'justify-end' : 'justify-start'} mb-4">
                        <div class="max-w-[75%]">
                            <div class="flex items-center gap-2 mb-1 ${isOwn ? 'justify-end' : 'justify-start'}">
                                ${!isOwn ? `
                                    <span class="text-2xl">${msg.avatar || 'üë§'}</span>
                                    <span class="text-sm font-bold ${isBot ? 'text-purple-400' : 'text-blue-400'}">${escapeHtml(msg.username)}</span>
                                ` : ''}
                                <span class="text-xs text-gray-500">${time}</span>
                                ${isOwn ? `
                                    <span class="text-sm font-bold text-green-400">${escapeHtml(msg.username)}</span>
                                    <span class="text-2xl">${msg.avatar || 'üë§'}</span>
                                ` : ''}
                            </div>
                            <div class="${isOwn ? 
                                'bg-gradient-to-r from-blue-600 to-blue-700 text-white' : 
                                isBot ?
                                'bg-gradient-to-r from-purple-600 to-purple-700 text-white' :
                                'bg-slate-700 text-white border border-slate-600'
                            } rounded-2xl px-4 py-3 shadow-lg">
                                <p class="text-sm leading-relaxed break-words whitespace-pre-wrap">${escapeHtml(msg.message)}</p>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            setTimeout(() => container.scrollTop = container.scrollHeight, 100);
        }

        function renderTradingSignals(container) {
            container.innerHTML = `
                <div class="space-y-4">
                    <div class="bg-blue-500/20 border border-blue-500 rounded-lg p-4">
                        <h3 class="text-xl font-bold text-blue-300 mb-2">üìä Signaux de Trading du Jour</h3>
                        <p class="text-sm text-gray-300">Analyse technique automatique mise √† jour toutes les heures</p>
                    </div>
                    
                    ${telegramState.signals.map(signal => {
                        const timeDiff = Math.floor((Date.now() - signal.timestamp) / 60000);
                        const timeStr = timeDiff < 60 ? `${timeDiff}min` : `${Math.floor(timeDiff / 60)}h`;
                        
                        const colors = {
                            'BUY': 'green',
                            'SELL': 'red',
                            'HOLD': 'yellow'
                        };
                        const color = colors[signal.type];
                        
                        return `
                            <div class="bg-slate-700/50 border border-${color}-500/50 rounded-lg p-4">
                                <div class="flex justify-between items-start mb-3">
                                    <div>
                                        <h4 class="text-lg font-bold text-${color}-400">${signal.type} ${signal.crypto}</h4>
                                        <p class="text-xs text-gray-400">Il y a ${timeStr}</p>
                                    </div>
                                    <div class="text-right">
                                        <p class="text-2xl font-bold">${signal.price}</p>
                                        <p class="text-xs text-gray-400">USDT</p>
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-2 gap-2 mb-3">
                                    ${signal.target ? `
                                        <div class="bg-slate-800 rounded p-2">
                                            <p class="text-xs text-gray-400">Target</p>
                                            <p class="text-sm font-bold text-green-400">${signal.target}</p>
                                        </div>
                                    ` : ''}
                                    ${signal.stopLoss ? `
                                        <div class="bg-slate-800 rounded p-2">
                                            <p class="text-xs text-gray-400">Stop Loss</p>
                                            <p class="text-sm font-bold text-red-400">${signal.stopLoss}</p>
                                        </div>
                                    ` : ''}
                                </div>
                                
                                ${signal.note ? `
                                    <p class="text-sm text-gray-300 mb-2">üí° ${signal.note}</p>
                                ` : ''}
                                
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-2">
                                        <div class="bg-${color}-500/20 px-2 py-1 rounded text-xs font-semibold text-${color}-400">
                                            Confiance: ${signal.confidence}%
                                        </div>
                                    </div>
                                    <button onclick="copySignal('${signal.crypto}', '${signal.type}')" class="px-3 py-1 bg-blue-600 hover:bg-blue-700 rounded text-xs transition-all">
                                        üìã Copier
                                    </button>
                                </div>
                            </div>
                        `;
                    }).join('')}
                    
                    <div class="bg-purple-500/20 border border-purple-500 rounded-lg p-4 text-center">
                        <p class="text-purple-300 font-semibold mb-2">ü§ñ Recevez les signaux en temps r√©el</p>
                        <button onclick="openTelegramBot()" class="px-6 py-2 telegram-gradient hover:opacity-90 rounded-lg font-semibold transition-all">
                            S'abonner via Telegram
                        </button>
                    </div>
                </div>
            `;
        }

        function renderBotCommands(container) {
            container.innerHTML = `
                <div class="space-y-4">
                    <div class="bg-purple-500/20 border border-purple-500 rounded-lg p-4">
                        <h3 class="text-xl font-bold text-purple-300 mb-2">ü§ñ Commandes Bot Telegram</h3>
                        <p class="text-sm text-gray-300">Utilisez ces commandes directement dans Telegram</p>
                    </div>
                    
                    <div class="bg-slate-700/50 rounded-lg p-4">
                        <h4 class="font-bold text-blue-300 mb-3">üì± Commandes de Base</h4>
                        <div class="space-y-2">
                            ${[
                                ['/start', 'D√©marrer le bot et voir le menu principal'],
                                ['/price [CRYPTO]', 'Obtenir le prix actuel (ex: /price BTC)'],
                                ['/signals', 'Recevoir les signaux de trading du jour'],
                                ['/stats', 'Voir vos statistiques de trading'],
                                ['/help', 'Liste compl√®te des commandes']
                            ].map(([cmd, desc]) => `
                                <div class="flex justify-between items-center bg-slate-800 rounded p-3 hover:bg-slate-700 transition-all">
                                    <div class="flex-1">
                                        <code class="text-blue-400 font-mono">${cmd}</code>
                                        <p class="text-xs text-gray-400 mt-1">${desc}</p>
                                    </div>
                                    <button onclick="sendTelegramCommand('${cmd}')" class="px-3 py-1 bg-blue-600 hover:bg-blue-700 rounded text-xs transition-all">
                                        Tester
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="bg-slate-700/50 rounded-lg p-4">
                        <h4 class="font-bold text-green-300 mb-3">üìä Commandes Trading</h4>
                        <div class="space-y-2">
                            ${[
                                ['/buy [CRYPTO] [AMOUNT]', 'Placer un ordre d\'achat'],
                                ['/sell [CRYPTO] [AMOUNT]', 'Placer un ordre de vente'],
                                ['/portfolio', 'Voir votre portfolio'],
                                ['/alert [CRYPTO] [PRICE]', 'Cr√©er une alerte de prix']
                            ].map(([cmd, desc]) => `
                                <div class="flex justify-between items-center bg-slate-800 rounded p-3 hover:bg-slate-700 transition-all">
                                    <div class="flex-1">
                                        <code class="text-green-400 font-mono">${cmd}</code>
                                        <p class="text-xs text-gray-400 mt-1">${desc}</p>
                                    </div>
                                    <button onclick="sendTelegramCommand('${cmd.split('[')[0].trim()}')" class="px-3 py-1 bg-green-600 hover:bg-green-700 rounded text-xs transition-all">
                                        Tester
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-blue-500/20 to-purple-500/20 border border-blue-500 rounded-lg p-4 text-center">
                        <p class="text-blue-300 font-semibold mb-3">üíé Fonctionnalit√©s Premium</p>
                        <ul class="text-sm text-gray-300 space-y-1 mb-4">
                            <li>‚úÖ Ex√©cution automatique des trades</li>
                            <li>‚úÖ Notifications en temps r√©el</li>
                            <li>‚úÖ Analyses techniques avanc√©es</li>
                            <li>‚úÖ Support prioritaire 24/7</li>
                        </ul>
                        <button onclick="openTelegramBot()" class="px-6 py-3 telegram-gradient hover:opacity-90 rounded-lg font-semibold transition-all">
                            Activer sur Telegram
                        </button>
                    </div>
                </div>
            `;
        }

        function sendTelegramMessage() {
            const input = document.getElementById('telegramInput');
            const message = input.value.trim();
            
            if (!message) {
                input.style.animation = 'shake 0.5s';
                setTimeout(() => input.style.animation = '', 500);
                return;
            }
            
            // Check if it's a command
            if (message.startsWith('/')) {
                sendTelegramCommand(message);
                input.value = '';
                return;
            }
            
            const newMessage = {
                username: telegramState.username,
                message: message,
                timestamp: Date.now(),
                type: 'user',
                avatar: 'üë§'
            };
            
            telegramState.messages.push(newMessage);
            saveTelegramMessages();
            
            if (telegramState.currentTab === 'chat') {
                renderChatContent('chat');
            }
            
            input.value = '';
            
            // Bot auto-response simulation
            setTimeout(() => {
                if (message.toLowerCase().includes('btc') || message.toLowerCase().includes('bitcoin')) {
                    addBotResponse(`Le prix actuel de BTC est de $94,850 üìà`);
                }
            }, 1000);
        }

        function sendTelegramCommand(command) {
            const input = document.getElementById('telegramInput');
            input.value = command;
            
            // Simulate command execution
            addBotResponse(`ü§ñ Commande "${command}" re√ßue. Ex√©cution en cours...`);
            
            setTimeout(() => {
                const responses = {
                    '/start': 'Bienvenue ! Voici les principales commandes disponibles:\n/price - Prix actuel\n/signals - Signaux du jour\n/help - Aide',
                    '/price': 'BTC: $94,850 (+2.3%)\nETH: $3,425 (+1.8%)\nBNB: $652 (-0.5%)',
                    '/signals': 'üìä 3 signaux disponibles. Consultez l\'onglet "Signaux Trading"',
                    '/stats': 'üìà Profit total: +15.3%\nüìä Trades gagnants: 23/30\nüí∞ Capital: $1,250',
                    '/help': 'Consultez la liste compl√®te des commandes dans l\'onglet "Bot Commands"'
                };
                
                const response = responses[command] || `Commande "${command}" ex√©cut√©e avec succ√®s ‚úÖ`;
                addBotResponse(response);
            }, 1500);
            
            input.value = '';
        }

        function addBotResponse(message) {
            const botMessage = {
                username: 'TradingBot',
                message: message,
                timestamp: Date.now(),
                type: 'bot',
                avatar: 'ü§ñ'
            };
            
            telegramState.messages.push(botMessage);
            saveTelegramMessages();
            
            if (telegramState.currentTab === 'chat') {
                renderChatContent('chat');
            }
        }

        function copySignal(crypto, type) {
            const signal = telegramState.signals.find(s => s.crypto === crypto && s.type === type);
            if (!signal) return;
            
            const text = `${type} ${crypto}\nPrix: ${signal.price}\nTarget: ${signal.target || 'N/A'}\nStop Loss: ${signal.stopLoss || 'N/A'}\nConfiance: ${signal.confidence}%`;
            
            navigator.clipboard.writeText(text).then(() => {
                alert('‚úÖ Signal copi√© dans le presse-papier');
            });
        }

        function showTelegramHelp() {
            document.getElementById('telegramGuideModal').classList.remove('hidden');
        }

        function closeTelegramGuide() {
            document.getElementById('telegramGuideModal').classList.add('hidden');
        }

        function saveTelegramMessages() {
            localStorage.setItem('telegramMessages', JSON.stringify(telegramState.messages));
        }

        function updateTelegramStats() {
            // Update online count
            setInterval(() => {
                const change = Math.floor(Math.random() * 10) - 5;
                telegramState.onlineUsers = Math.max(500, telegramState.onlineUsers + change);
                document.getElementById('telegramOnlineCount').textContent = telegramState.onlineUsers;
                document.getElementById('telegramOnline').textContent = telegramState.onlineUsers;
            }, 30000);
            
            // Update members count
            const membersCount = Math.floor(Math.random() * 500) + 1000;
            document.getElementById('telegramMembersCount').textContent = membersCount.toLocaleString();
        }

        function updateUnreadBadge() {
            const badge = document.getElementById('unreadBadge');
            if (telegramState.unreadCount > 0) {
                badge.textContent = telegramState.unreadCount;
                badge.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
            }
        }

        function startTelegramSimulation() {
            // Simulate community activity
            const usernames = ['AlphaTrader', 'CryptoNinja', 'MoonBoy', 'DiamondHands', 'TechAnalyst'];
            const messages = [
                'BTC cassant la r√©sistance ! üöÄ',
                'Volume ETH en hausse significative',
                'Signal haussier d√©tect√© sur BNB',
                'Qui trade aujourd\'hui ?',
                'Mon bot a fait +2.8% ce matin',
                'RSI en survente, opportunit√© ?'
            ];
            
            setInterval(() => {
                if (Math.random() > 0.7) {
                    const username = usernames[Math.floor(Math.random() * usernames.length)];
                    const message = messages[Math.floor(Math.random() * messages.length)];
                    
                    const newMsg = {
                        username: username,
                        message: message,
                        timestamp: Date.now(),
                        type: 'user',
                        avatar: ['üëë', 'üíé', 'üêã', 'üöÄ', '‚ö°'][Math.floor(Math.random() * 5)]
                    };
                    
                    telegramState.messages.push(newMsg);
                    if (telegramState.messages.length > 100) {
                        telegramState.messages.shift();
                    }
                    
                    saveTelegramMessages();
                    
                    // Update preview
                    updateTelegramPreview();
                    
                    // Increment unread if chat is closed
                    if (document.getElementById('telegramChatModal').classList.contains('hidden')) {
                        telegramState.unreadCount++;
                        updateUnreadBadge();
                    }
                }
            }, 45000); // Every 45 seconds
        }

        function updateTelegramPreview() {
            const preview = document.getElementById('telegramPreview');
            const recent = telegramState.messages.slice(-5).reverse();
            
            preview.innerHTML = recent.map(msg => `
                <div class="bg-slate-700/50 rounded-lg p-3 text-sm">
                    <div class="flex items-center gap-2 mb-1">
                        <span>${msg.avatar || 'üë§'}</span>
                        <span class="font-semibold text-blue-400">${escapeHtml(msg.username)}</span>
                        <span class="text-xs text-gray-500">${new Date(msg.timestamp).toLocaleTimeString('fr-FR', {hour: '2-digit', minute: '2-digit'})}</span>
                    </div>
                    <p class="text-gray-300 truncate">${escapeHtml(msg.message)}</p>
                </div>
            `).join('');
        }

        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }

        function openDCASwap() {
            window.open('https://reboot-20.vercel.app/', '_blank');
        }

        function connectWallet() {
            // Votre fonction de connexion wallet existante
            alert('Fonction de connexion wallet - √Ä impl√©menter');
        }

        // Initialize preview on load
        setTimeout(updateTelegramPreview, 1000);
    </script>
</body>
</html>
